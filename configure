#! /usr/bin/env node
/* vim:set ft=javascript : */
/*
 * Nodelint [VERSION]
 * [DATE]
 * A fork of tav's nodelint (http://github.com/tav/nodelint)
 * Corey Hart @ http://www.codenothing.com
 */
var sys = require('sys'),
	fs = require('fs'),
	path = require('path'),
	rdash = /^--/,
	marker = 0,
	normalize = { jslint: true, prefix: true };
	config = {
		jslint: null,
		prefix: process.installPrefix,
		blocklibs: false
	};


// Set options
process.argv.forEach(function( arg ) {
	var parts = arg.replace( rdash, '' ).split('='), name = parts[ 0 ], value = parts[ 1 ];

	if ( ! name || ! rdash.exec( arg ) ) {
		return;
	}

	// Set the configuration value
	config[ name ] = normalize[ name ] && value ? path.normalize( value.replace( /^\~\//, process.env.HOME + '/' ) ) :
		arg.indexOf( '=' ) > -1 ? value :
		true;
});


// Store configuration
fs.writeFile( __dirname + '/dist/.config', JSON.stringify( config ), 'utf8', function( e ) {
	if ( e ) {
		sys.error( e );
		process.exit( 1 );
	}
});
