#! /usr/bin/env node
/* vim:set ft=javascript : */
/*
 * Nodelint [VERSION]
 * [DATE]
 * A fork of tav's nodelint (http://github.com/tav/nodelint)
 * Corey Hart @ http://www.codenothing.com
 */
var sys = require('sys'),
	fs = require('fs'),
	path = require('path'),
	rdash = /^--/,
	config = {
		jslint: null,
		prefix: process.installPrefix
	};

// Set options
process.argv.forEach(function( arg ) {
	var parts = arg.replace( rdash, '' ).split('='), name = parts[ 0 ], value = parts[ 1 ];

	if ( ! name || ! config.hasOwnProperty( name ) || ! value ) {
		return;
	}

	// Paths need to be normalized
	if ( name == 'jslint' || name == 'prefix' ) {
		config[ name ] = path.normalize( value );
	}
});


// Stores the configuration
function write(){
	fs.writeFile('build/.config', JSON.stringify( config ), 'utf8', function( e ) {
		if ( e ) {
			sys.error( e );
			process.exit( 1 );
		}
	});
}

// Make sure build directory exists
path.exists('build/', function( exists ) {
	if ( exists ) {
		write();
	}
	else {
		fs.mkdir( 'build', '755', write );
	}
});
